# 배차 요청 자동화 시스템 - 구글 앱스 스크립트

## 개요
구글 폼으로 제출된 배차 요청 텍스트를 자동으로 파싱하여 구글 시트의 '파싱결과' 시트에 정제된 데이터를 저장하는 시스템입니다.

## 설정 방법

### 1. 구글 시트 준비
- 구글 시트를 생성하고 다음 시트들을 준비합니다:
  - **설문지 응답**: 구글 폼 응답이 자동으로 저장되는 시트
  - **파싱결과**: 파싱된 데이터가 저장될 시트 (자동 생성됨)

### 2. 구글 앱스 스크립트 설정
1. 구글 시트에서 `확장 프로그램` > `Apps Script` 클릭
2. `Code.js` 파일의 내용을 복사하여 붙여넣기
3. `SPREADSHEET_ID` 변수를 실제 구글 시트 ID로 변경
   ```javascript
   const SPREADSHEET_ID = "YOUR_SPREADSHEET_ID";
   ```
   - 시트 ID는 구글 시트 URL에서 확인 가능: `https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}/edit`

### 3. 트리거 설정
1. Apps Script 편집기에서 `initialize()` 함수 실행
2. 또는 수동으로 `setupFormResponseTrigger()` 함수 실행
3. 권한 승인 (처음 실행 시)

### 4. 구글 폼 연결 확인
- 구글 폼이 구글 시트의 '설문지 응답' 시트와 연결되어 있는지 확인
- 시트의 컬럼 구조:
  - 타임스탬프
  - 운송계약번호
  - 배차 요청 내용
  - 처리상태 (자동 생성됨)

### 5. 처리상태 컬럼 자동 생성
- `initialize()` 함수 실행 시 '설문지 응답' 시트에 '처리상태' 컬럼이 자동으로 추가됩니다
- 처리상태 컬럼이 없으면 자동으로 생성되며, 기존 데이터는 "대기" 상태로 설정됩니다
- 처리상태 값:
  - **대기**: 아직 처리되지 않은 응답
  - **처리중**: 현재 파싱 중인 응답
  - **처리완료**: 파싱이 완료된 응답
  - **처리오류**: 파싱 중 오류가 발생한 응답

## 주요 기능

### 자동 파싱
- 구글 폼에 응답이 제출되면 자동으로 텍스트를 파싱합니다
- 다음 정보를 추출합니다:
  - 상차일자
  - 하차일자
  - 상차지명/주소
  - 하차지명/주소
  - 요청톤수
  - 담당자명/연락처
  - 비고

### 지원하는 텍스트 형식
다양한 형식의 배차 요청 텍스트를 지원합니다:
- 표준 형식: `[배차요청]` 형식
- 간단 형식: `출 :`, `착 :` 형식
- 자유 형식: 다양한 키워드 조합

### 날짜 형식 지원
- `25.05.27` (2자리 연도)
- `2025.05.26` (4자리 연도)
- `5/27` (월/일)
- `5월 27일` (한글 형식)
- `금일`, `오늘`, `익일`, `내일` 등

## 함수 설명

### 주요 함수
- `setupFormResponseTrigger()`: 트리거 설정
- `onFormSubmit()`: 구글 폼 제출 이벤트 처리
- `processFormResponse()`: 폼 응답 처리
- `parseTransportRequest()`: 배차 요청 텍스트 파싱
- `insertToParsedSheet()`: 파싱 결과를 시트에 저장

### 유틸리티 함수
- `extractValue()`: 키워드 기반 값 추출
- `parseDate()`: 날짜 파싱
- `extractAddress()`: 주소 추출
- `extractCompanyName()`: 업체명 추출
- `extractPhone()`: 전화번호 추출
- `extractContactName()`: 담당자명 추출
- `extractTonnage()`: 톤수 추출

### 수동 처리 함수
- `processAllFormResponses()`: 모든 미처리 응답 일괄 처리
- `testSpecificFormResponse(rowNumber)`: 특정 행 테스트

## 파싱 결과 시트 구조

파싱 결과는 다음 컬럼 구조로 저장됩니다:

| 컬럼명 | 설명 | 필수 |
|--------|------|------|
| No. | 순번 | - |
| 운송계약번호* | 계약 번호 | ✓ |
| 고객사명 | 고객사 이름 | - |
| 운송단가번호 | 운송 단가 번호 | - |
| 상차일자* | 상차 일자 | ✓ |
| 하차일자* | 하차 일자 | ✓ |
| 상차지명* | 상차지 이름 | ✓ |
| 상차지주소* | 상차지 주소 | ✓ |
| 하차지명* | 하차지 이름 | ✓ |
| 하차지주소* | 하차지 주소 | ✓ |
| 요청톤수* | 요청 톤수 | ✓ |
| 담당자명 | 담당자 이름 | - |
| 담당자연락처 | 담당자 연락처 | - |
| 비고 | 기타 사항 | - |

## 문제 해결

### 트리거가 작동하지 않는 경우
1. `initialize()` 함수를 다시 실행
2. Apps Script 편집기에서 트리거 확인: `트리거` 탭 확인

### 파싱이 제대로 되지 않는 경우
1. `testSpecificFormResponse(rowNumber)` 함수로 특정 행 테스트
2. Apps Script 로그 확인: `실행` > `실행 기록` 확인

### 처리상태가 업데이트되지 않는 경우
- '설문지 응답' 시트에 '처리상태' 컬럼이 있는지 확인
- 없으면 수동으로 추가 가능 (자동 처리됨)

## 주의사항
- 구글 앱스 스크립트는 일일 실행 시간 제한이 있습니다
- 대량의 데이터를 처리할 경우 시간이 걸릴 수 있습니다
- 파싱 결과는 덮어쓰지 않고 항상 새 행으로 추가됩니다

